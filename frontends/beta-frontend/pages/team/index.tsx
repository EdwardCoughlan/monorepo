import type { NextPage } from 'next'
import Head from 'next/head'
import { Box } from '@mui/material'
import Grid from '@/shared/components/Grid/Grid'
import { GridColDef } from '@mui/x-data-grid'
import useSWR from 'swr'
import { SampleTeam } from '@/data/SampleTeam'
import { PlayerStats } from '@/data/SamplePlayer'
import TeamDetails from '@/shared/components/TeamDetails'
import PlayerTactics from '@/shared/components/PlayerTactics'
import TeamTactics from '@/shared/components/TeamTactics'
import fetcherFactory from '@/libs/fetcher'
import { useSession } from 'next-auth/react'

const Team: NextPage = () => {
  const payload = {
    username: 'Carlos2',
    password: '123456',
    grant_type: 'password',
    client_id: 'client-id',
    client_secret: 'client-secret',
  }
  const { data: session } = useSession()
  console.log(session)
  const { data, isLoading } = useSWR<PlayerStats[]>('/players', fetcherFactory({ token: session?.user as unknown as string }))
  const fetcher = fetcherFactory()
  const { data: token } = useSWR<PlayerStats[]>('/oauth/token', (url) => fetcher(url, { data: payload, method: 'POST' }))
  console.log(token)

  const columns: GridColDef[] = [
    {
      field: 'name',
      headerName: 'Name',
      type: 'string',
      sortable: true,
    },
    {
      field: 'age',
      headerName: 'Age',
      type: 'number',
      sortable: true,
    },
    {
      field: 'position',
      headerName: 'Position',
      type: 'string',
      sortable: true,
    },
  ]

  return (
    <>
      <Head>
        <title>Kjeldsen</title>
        <meta name="description" content="Generated by create next app" />
      </Head>
      <Box>
        <Box sx={{ display: 'flex', marginBottom: '2rem', alignItems: 'center' }}>
          <TeamDetails {...SampleTeam} />
          <PlayerTactics />
          <TeamTactics />
        </Box>
        {isLoading ? <span>Loading...</span> : <Grid rows={data || []} columns={columns} />}
      </Box>
    </>
  )
}

export default Team
